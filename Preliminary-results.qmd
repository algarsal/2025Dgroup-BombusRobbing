```{r}

```

---
title: "Nectar robbing by Bombus terrestris and its ecological effects"
author: "Vikas Nehra, Rolf, Sina Mesri, Guillem Soler"
number-sections: true
format: html
editor: visual
---

## Introduction

Nectar robbing occurs when floral visitors access nectar without effectively contributing to pollination, typically by bypassing contact with the reproductive structures of the flower. In invaded communities, Bombus terrestris has emerged as a particularly important nectar robber, frequently piercing the corollas of Fuchsia magellanica to extract nectar while providing little or no pollination service. This behavior can reduce nectar availability in individual flowers and potentially modify the foraging decisions of native pollinators, such as hummingbirds, which rely on nectar as a primary energy source.

Biological invasions are increasingly recognized as a major driver of change in mutualistic networks, where plants and pollinators are linked through reciprocal dependence on rewards and pollination. The introduction of B. terrestris adds a novel interaction mode—systematic nectar robbing—that may weaken the quantity or quality of pollination that native plants receive, even when flowers continue to be visited. Within this context, Fuchsia magellanica, a nectar‑rich, hummingbird‑pollinated shrub, provides an ideal model system to examine how invasive nectar robbers can restructure plant–pollinator interactions. The central questions are whether nectar robbing by B. terrestris depletes floral nectar sufficiently to alter the visitation patterns of native hummingbirds and other visitors, and whether any such changes ultimately reduce seed set.

To address these questions, the study quantifies nectar production and standing nectar crop in robbed and unrobbed flowers, characterizes shifts in the frequency and type of visits by native pollinators and other floral visitors, and estimates female reproductive success through seed production. By jointly considering behavioral responses and reproductive outcomes, the project offers a nuanced view of invasion impacts that goes beyond simple presence–absence effects. It highlights that invasive species may substantially modify the structure and function of native mutualisms at the behavioral level while producing more subtle or context‑dependent consequences for plant fitness, thereby providing a framework to assess how novel interaction modes, such as nectar robbing, can uncouple short‑term disruption of mutualisms from longer‑term demographic effects on native plants.

## Objectives

-   The project is structured around three main objectives:

    -   To quantify the effect of nectar robbing by Bombus terrestris on nectar production and standing nectar crop in flowers of Fuchsia magellanica.

    -   To determine how nectar robbing alters the visitation rates and behavioral patterns of native flower visitors, particularly the main hummingbird pollinator.

    -   To evaluate whether changes in nectar availability and visitor behavior associated with nectar robbing lead to differences in female reproductive success, measured as seed set.

## Hypotheses

-   H1: Higher levels of nectar robbing are associated with reduced visitation rates and/or altered visitation behavior by native pollinators, particularly hummingbirds.

-   H2: Despite changes in visitation patterns, nectar robbing does not strongly reduce seed set in Fuchsia magellanica, indicating a partial decoupling between behavioral disruption and reproductive output.

## Methods

```{r}
# Global setup
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.path = "results/"
)

# Load required packages
library(readxl)
library(dplyr)
library(ggplot2)

# Create results folder if missing
if (!dir.exists("results")) dir.create("results")

```

# Download data directly

```{r}
# Correct URL (NO brackets, NO markdown)
url <- "https://dfzljdn9uc3pi.cloudfront.net/2025/20253/1/Raw_data.xlsx"

tmp <- tempfile(fileext = ".xlsx")

download.file(
  url = url,
  destfile = tmp,
  mode = "wb",
  quiet = TRUE
)

df <- readxl::read_excel(tmp, sheet = 1)


# Convert relevant columns to numeric

num_cols <- c(
"Total pollinating visits (visits/flower/10 min)",
"Pollinating visits by B. terrestris (visits/flower/10 min)",
"Total robbing visits (visits/flower/10 min)",
"Standing crop of nectar from pierced flower (µl/flower)",
"Standing crop of nectar from undamaged flower (µl/flower)",
"Seeds/flower (+P+R)"
)

df[num_cols] <- lapply(df[num_cols], as.numeric)

# Derived variables

df$native_visits <-
df$`Total pollinating visits (visits/flower/10 min)` -
df$`Pollinating visits by B. terrestris (visits/flower/10 min)`

df$robbed_status <- ifelse(
df$`Total robbing visits (visits/flower/10 min)` > 0,
"Robbed", "Unrobbed"
)

# Overview

nrow(df)
ncol(df)
```

# Results

## 1. Native pollinator visits and nectar robbing

```{r}
ggplot(df, aes(robbed_status, native_visits)) +
geom_boxplot(fill = "lightgray") +
geom_jitter(width = 0.2, alpha = 0.6) +
labs(
x = "Flower status",
y = "Native visits (visits/flower/10 min)",
title = "Native pollinator visits on robbed vs unrobbed flowers"
)
```

Native pollinator visitation tended to differ between robbed and unrobbed flowers, suggesting that nectar robbing may influence flower visitor behavior.

# 2. Relationship between robbing intensity and native visits

```{r}
ggplot(df, aes(
`Total robbing visits (visits/flower/10 min)`,
native_visits
)) +
geom_point(alpha = 0.6) +
geom_smooth(method = "lm", se = TRUE) +
labs(
x = "Robbing visits (visits/flower/10 min)",
y = "Native visits (visits/flower/10 min)",
title = "Relationship between nectar robbing and native visitation"
)
```

A negative trend would support the hypothesis that increasing nectar robbing reduces native pollinator activity.

# 3. Nectar standing crop: pierced vs undamaged flowers

```{r}
nectar_long <- df %>%
select(
`Standing crop of nectar from pierced flower (µl/flower)`,
`Standing crop of nectar from undamaged flower (µl/flower)`
) %>%
tidyr::pivot_longer(
everything(),
names_to = "Flower_type",
values_to = "Nectar"
)

ggplot(nectar_long, aes(Flower_type, Nectar)) +
geom_boxplot(fill = "lightblue") +
labs(
x = "Flower type",
y = "Nectar volume (µl)",
title = "Nectar standing crop in pierced and undamaged flowers"
)
```

Pierced flowers generally contained less nectar, indicating direct effects of nectar robbing on floral resources.

# 4. Seed set and nectar robbing

```{r}
ggplot(df, aes(robbed_status, `Seeds/flower (+P+R)`)) +
geom_boxplot(fill = "lightgreen") +
geom_jitter(width = 0.2, alpha = 0.6) +
labs(
x = "Flower status",
y = "Seeds per flower",
title = "Seed set in robbed vs unrobbed flowers"
)
```

Seed production appeared broadly similar between robbed and unrobbed flowers.

## ANOVA

In this section we evaluate whether seed set differs between robbed and unrobbed flowers of *Fuchsia magellanica* using an analysis of variance (ANOVA). We then apply a Tukey post hoc test and summarize significant differences with letters in a boxplot.

PRESeNCIA DE SEMILLAS O NO

(CHI CUADRADO)

SI QUITAMOS LOS CEROS TENEMOS LOS VALORES CON SEMILLAS COMO CAMBIA EL NUMWRO DE SEMILLAS EN BASE AL ROBBED UNROBBED

MIRAR SI LA POISSON DISTRIBUTION TIENE MAS SENTIDO PARA CONTEO EN ESTE CAOS PORQW LA DISTRIBUCIÓN LO PARECE –\> en vez de usar AOV usamos glm al finalc hay q poner family=poisson

\# ANOVA: effect of robbing on seed set

```{r}
anova_seed <- aov(`Seeds/flower (+P+R)` ~ robbed_status, data = df)
summary(anova_seed)
```

\# Turkey post hoc and significance letters for robbing levels

```{r}
# Turkey post hoc and significance letters for robbing levels
library(multcompView)

tukey_seed <- TukeyHSD(anova_seed)

# Extract adjusted p-values for robbed_status
tukey_res <- tukey_seed$robbed_status[ , "p adj"]
names(tukey_res) <- rownames(tukey_seed$robbed_status)

# Get compact letter display
letters_seed <- multcompLetters(tukey_res)$Letters

letters_df <- data.frame(
  robbed_status = names(letters_seed),
  Letters = letters_seed,
  row.names = NULL
)

# Summary table for plotting
seed_summary <- df %>%
  dplyr::group_by(robbed_status) %>%
  dplyr::summarise(
    Mean = mean(`Seeds/flower (+P+R)`, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  dplyr::left_join(letters_df, by = "robbed_status") %>%
  dplyr::mutate(
    robbed_status = factor(robbed_status,
                           levels = levels(df$robbed_status))
  )

# Maximum seed value for positioning letters
max_seed <- max(df$`Seeds/flower (+P+R)`, na.rm = TRUE)

```

```{r}
# Filter out NA in robbed_status
df_seed <- df %>%
  dplyr::filter(!is.na(robbed_status))

# Refit ANOVA on filtered data
anova_seed <- aov(`Seeds/flower (+P+R)` ~ robbed_status, data = df_seed)
summary(anova_seed)

# Tukey + letters with filtered data
tukey_seed  <- TukeyHSD(anova_seed)
tukey_res   <- tukey_seed$robbed_status[, "p adj"]
names(tukey_res) <- rownames(tukey_seed$robbed_status)

letters_seed <- multcompView::multcompLetters(tukey_res)$Letters
letters_df   <- data.frame(
  robbed_status = names(letters_seed),
  Letters       = letters_seed,
  row.names     = NULL
)

seed_summary <- df_seed %>%
  dplyr::group_by(robbed_status) %>%
  dplyr::summarise(
    Mean = mean(`Seeds/flower (+P+R)`, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  dplyr::left_join(letters_df, by = "robbed_status")

max_seed <- max(df_seed$`Seeds/flower (+P+R)`, na.rm = TRUE)

#| fig-cap: Seed set (seeds per flower) in robbed and unrobbed flowers of *Fuchsia magellanica*. Different letters (in red) indicate significant differences between robbing categories according to Tukey post hoc ANOVA (alpha = 0.05).

ggplot(df_seed, aes(x = robbed_status,
                    y = `Seeds/flower (+P+R)`,
                    fill = robbed_status)) +
  geom_boxplot() +
  geom_jitter(width = 0.15, alpha = 0.5) +
  geom_text(data = seed_summary,
            aes(x = robbed_status,
                y = max_seed * 1.05,
                label = Letters),
            color = "red",
            size = 5,
            vjust = 0) +
  labs(
    x = "Flower status",
    y = "Seeds per flower"
  ) +
  theme_minimal() +
  theme(legend.position = "none")


```

## Discussion

Nectar robbing by Bombus terrestris was associated with changes in native pollinator visitation patterns, supporting the hypothesis that robbing modifies flower visitor behavior. However, seed set showed limited sensitivity to robbing, suggesting compensatory mechanisms in plant reproduction.

## Conclusions

Nectar robbing is associated with changes in native pollinator visitation.

Seed production does not appear to be strongly reduced by robbing.

These results support the idea that behavioral effects may occur without immediate reproductive consequences.
